# 設計仕様

## 機能仕様

### 瞑想タイマー（紫 #7C3AED）

**動作**:

```
開始 → カウントダウン → 完了音 → セッション保存
         ├ 一時停止/再開 可
         └ 停止 → 記録なし
```

**設定項目**:

- 時間: 2, 5, 7, 10, 15分
- デフォルト: 5分

**制約**:

- 時間選択UIは非表示（設定画面からのみ変更可能）
- 一時停止中も経過時間はカウント

---

### メモ書きタイマー（青 #2563EB）

**動作（ゼロ秒思考）**:

```
書き込み1分 → [5秒前からピッピ] → 完了音
              ↓
休憩10秒 → [5秒前からピッピ] → 再開音
              ↓
書き込み1分 → ... (10回繰り返し) → セッション保存
```

**設定項目**:

- 書き込み時間: 1分, 2分, 5分, 7分, 10分
- 休憩時間: 5秒, 10秒, 15秒
- デフォルト: 書き込み1分、休憩10秒

**制約**:

- **固定10ページ**（変更不可）
- メモ入力欄なし（紙に書く前提）
- カウントダウン音: 残り5秒以下で毎秒ビープ（5,4,3,2,1）
- 休憩スキップ不可
- 最終ページ（10ページ目）の後は休憩なし

**ページ進行インジケーター**:

- 完了: 青丸
- 書き込み中: 青丸（点滅）
- 休憩中: 黄丸（点滅）
- 未完了: グレー丸

---

### 履歴・統計

**統計カード（4つ）**:

1. 連続記録日数: オレンジ
   - 今日または昨日から遡って連続でセッションがある日数
   - 今日セッションなし → 昨日から計算
2. 瞑想回数: 紫
3. メモ書き回数: 青
4. 合計時間: グレー（分単位）

**セッション一覧**:

- 新しい順
- 削除機能あり

---

## データ構造

### Session（LocalStorage: `meditation-journaling-sessions`）

```typescript
interface Session {
  id: string; // UUID（必須）
  type: "meditation" | "journaling"; // 必須
  duration: number; // 秒数（必須、正の整数）
  content?: string; // 未使用（将来拡張用）
  completedAt: string; // ISO 8601（必須）
  score?: number; // 未使用（将来拡張用）
}
```

**制約**:

- `id`: crypto.randomUUID() で生成
- `duration`: 実際の経過時間（一時停止含む）
- `completedAt`: セッション完了時のタイムスタンプ
- 配列で保存、先頭が最新

---

### AppSettings（LocalStorage: `meditation-journaling-settings`）

```typescript
interface AppSettings {
  meditationDuration: number; // 分（必須）
  journalingDuration: number; // 秒（必須）
  journalingBreakDuration: number; // 秒（必須）
}
```

**デフォルト値**:

```typescript
{
  meditationDuration: 5,           // 5分
  journalingDuration: 60,          // 1分
  journalingBreakDuration: 10      // 10秒
}
```

**制約**:

- すべて正の整数
- 設定がない場合はデフォルト値を使用

---

### DailyStats（計算で生成、保存なし）

```typescript
interface DailyStats {
  date: string; // YYYY-MM-DD
  meditationCount: number; // その日の瞑想回数
  journalingCount: number; // その日のメモ書き回数
  totalDuration: number; // その日の合計時間（秒）
}
```

**生成ロジック**:

- Session配列を日付でグループ化
- completedAtから日付を抽出（UTC → ローカルタイムゾーン変換）

---

## 音声仕様

### ビープ音（カウントダウン用）

**用途**: メモ書きタイマーの警告音
**タイミング**: timeLeft が 5, 4, 3, 2, 1 のとき（毎秒）
**実装**: Base64 WAV（埋め込み）

### 完了音

**用途**:

- 瞑想タイマー完了
- メモ書きページ完了
- メモ書き休憩完了

**実装**: Base64 WAV（埋め込み）

**制約**:

- ブラウザの自動再生ポリシーによりエラー時は無視
- 音量調整なし（ブラウザ設定に依存）

---

## ビジネスルール

### 連続記録日数（ストリーク）の計算

1. 今日のセッションがあるか確認
2. なければ昨日から開始
3. 前日にセッションがなければ中断

### データ制限

- LocalStorage容量: 5MB（ブラウザ標準、現時点の永続化）
- PostgreSQL移行中（Supabase、スキーマ実装済み）
- 想定レコード数: 1000件まで問題なし
- 超過時の動作: 古いデータの手動削除を促す（自動削除なし）

### 削除動作

- セッション削除: 物理削除（復元不可）
- 設定リセット: なし（デフォルト値への復元機能なし）

---

## 技術制約

### 対応ブラウザ

- Chrome, Firefox, Safari, Edge（最新版）
- IE非対応
- LocalStorage必須

### 非対応機能（現時点）

- オフライン動作（PWAなし）
- クラウド同期（PostgreSQL移行後で対応予定）
- データバックアップ（プレミアム機能として検討中）
- データエクスポート/インポート（プレミアム機能として検討中）
